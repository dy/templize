let e,r,t,o,a,s,l,n=(o,a=(r=o,e=0,t=[],!(o=i())||r[e]?c():e=>o(e||{})))=>(a.args=t,a),b=e=>e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122||36==e||95==e||e>=192&&215!=e&&247!=e,c=(t="Bad syntax",o=r[e])=>{throw SyntaxError(t+" `"+o+"` at "+e)},f=(t=1,o=e,a)=>{if("number"==typeof t)e+=t;else for(;t(r.charCodeAt(e));)e++;return r.slice(o,e)},i=(r=0,t,o,a,s,l)=>{for(;(o=d())&&(s=(l=h[o])&&l(a,r)||!a&&u());)a=s;return t&&(o==t?e++:c()),a},d=t=>{for(;(t=r.charCodeAt(e))<=32;)e++;return t},u=(e=f(b),r)=>e?(r=r=>r[e],t.push(e),r.id=()=>e,r):0,h=[],y=n.set=(t,o,a=32,s=t.charCodeAt(0),l=t.length,n=h[s],c=a.length||([a,o]=[o,a],0),f=t.toUpperCase()!==t,d=(c>1?(e,r)=>e&&(r=i(o))&&(e.length||r.length?t=>a(e(t),r(t),e.id?.(t),r.id?.(t)):(e=a(e(),r()),()=>e)):c?e=>!e&&(e=i(o-1))&&(r=>a(e(r))):a))=>h[s]=(a,s,c=e)=>s<o&&(l<2||r.substr(e,l)==t)&&(!f||!b(r.charCodeAt(e+l)))&&(e+=l,d(a,s))||(e=c,n&&n(a,s)),p=e=>e>=48&&e<=57,m=t=>(t&&c("Unexpected number"),t=f((e=>46==e||p(e))),(69==r.charCodeAt(e)||101==r.charCodeAt(e))&&(t+=f(2)+f(p)),(t=+t)!=t?c("Bad number"):()=>t),x=(e,r)=>t=>r(e.of?e.of(t):t,e.id(t));for(a=48;a<=57;)h[a++]=m;for(o=['"',e=>(e=e?c("Unexpected string"):f((e=>e-34)),f()||c("Bad string"),()=>e),,".",(e,r)=>(d(),r=f(b)||c(),l=t=>e(t)[r],l.id=()=>r,l.of=e,l),18,".",e=>!e&&m(f(-1)),,"[",(e,r,t)=>e&&(r=i(0,93)||c(),(t=t=>e(t)[r(t)]).id=r,t.of=e,t),18,"(",(e,r,t)=>(r=i(0,41),e?t=>e(t).apply(e.of?.(t),r?r.all?r.all(t):[r(t)]:[]):r||c()),18,",",(e,r,t=i(1))=>(t.all=e.all?r=>[...e.all(r),t(r)]:r=>[e(r),t(r)],t),1,"|",6,(e,r)=>e|r,"||",4,(e,r)=>e||r,"&",8,(e,r)=>e&r,"&&",5,(e,r)=>e&&r,"^",7,(e,r)=>e^r,"==",9,(e,r)=>e==r,"!=",9,(e,r)=>e!=r,">",10,(e,r)=>e>r,">=",10,(e,r)=>e>=r,">>",11,(e,r)=>e>>r,">>>",11,(e,r)=>e>>>r,"<",10,(e,r)=>e<r,"<=",10,(e,r)=>e<=r,"<<",11,(e,r)=>e<<r,"+",12,(e,r)=>e+r,"+",15,e=>+e,"++",e=>x(e||i(14),e?(e,r)=>e[r]++:(e,r)=>++e[r]),15,"-",12,(e,r)=>e-r,"-",15,e=>-e,"--",e=>x(e||i(14),e?(e,r)=>e[r]--:(e,r)=>--e[r]),15,"!",15,e=>!e,"*",13,(e,r)=>e*r,"/",13,(e,r)=>e/r,"%",13,(e,r)=>e%r];[a,s,l,...o]=o,a;)y(a,s,l);Symbol.observable||(Symbol.observable=Symbol("observable"));const S=(e,r,t)=>(r.next=r,e&&(e.subscribe?.(r)||e[Symbol.observable]?.().subscribe?.(r)||e.set&&e.call?.(t,r)||(e.then?.((e=>!t&&r(e)))||(async o=>{for await(e of e){if(t)return;r(e)}})())&&(e=>t=1)));n.set(":",3.1,((e,r)=>[e,r])),n.set("?",3,((e,r)=>e?r[0]:r[1])),n.set("true",(e=>{if(e)throw new SyntaxError("Unexpected");return()=>!0})),n.set("false",(e=>{if(e)throw new SyntaxError("Unexpected");return()=>!1})),n.set("?.",18,((e,r,t,o)=>e?.[o])),n.set("|",6,((e,r)=>r(e)));const v=Symbol(),C=Symbol();var g={createCallback(e,r,t){e[v]=t;for(const e of r)e.evaluate=n(e.expression);let o,a=[];for(const l in t)(s=o=t[l])&&(s[Symbol.observable]||s[Symbol.asyncIterator]||s.call&&s.set||s.subscribe||s.then)&&(t[l]="",a.push(S(o,(t=>this.processCallback(e,r,{[l]:t})))));var s;e[C]=!0},processCallback(e,r,t){if(Object.assign(e[v],t),e[C])for(const t of r)t.value=t.evaluate(e[v])}};export{g as default};