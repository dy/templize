const e=(t,r,s,a=null)=>{let n,o,l,i=0,c=s.length,p=r.length,{remove:u,same:h,insert:d,replace:f}=e;for(;i<c&&i<p&&h(r[i],s[i]);)i++;for(;i<c&&i<p&&h(s[c-1],r[p-1]);)a=s[(--p,--c)];if(i==p)for(;i<c;)d(a,s[i++],t);else{for(n=r[i];i<c;)l=s[i++],o=n?n.nextSibling:a,h(n,l)?n=o:i<c&&h(s[i],o)?(f(n,l,t),n=o):d(n,l,t);for(;!h(n,a);)o=n.nextSibling,u(n,t),n=o}return s};e.same=(e,t)=>e==t,e.replace=(e,t,r)=>r.replaceChild(t,e),e.insert=(e,t,r)=>r.insertBefore(t,e),e.remove=(e,t)=>t.removeChild(e);const t={processCallback(e,t,r){if(r)for(const e of t)e.expression in r&&(e.value=r[e.expression])}};class r extends DocumentFragment{#e;#t;constructor(e,r,s=t){super(),this.appendChild(e.content.cloneNode(!0)),this.#e=l(this),this.#t=s,r||={},s.createCallback?.(this,this.#e,r),s.processCallback(this,this.#e,r)}update(e){this.#t.processCallback(this,this.#e,e)}}class s{constructor(e,t){this.setter=e,this.expression=t}toString(){return this.value}}class a extends s{#r="";get attributeName(){return this.setter.attr.name}get attributeNamespace(){return this.setter.attr.namespaceURI}get element(){return this.setter.element}get value(){return this.#r}set value(e){if(this.#r===e)return;this.#r=e;const{attr:t,element:r,parts:s}=this.setter;1===s.length?null==e?r.removeAttributeNS(t.namespaceURI,t.name):r.setAttributeNS(t.namespaceURI,t.name,e):r.setAttributeNS(t.namespaceURI,t.name,s.join(""))}get booleanValue(){this.setter.element.hasAttribute(this.setter.attr.name)}set booleanValue(e){if(1!==this.setter.parts.length)throw new DOMException("Value is not fully templatized");this.value=e?"":null}}class n extends s{#s=[new Text];get replacementNodes(){return this.#s}get parentNode(){return this.setter.parentNode}get nextSibling(){return this.#s[this.#s.length-1].nextSibling}get previousSibling(){return this.#s[0].previousSibling}get value(){return this.#s.map((e=>e.textContent)).join("")}set value(e){this.replace(e)}replace(...t){t=t.length?t.flatMap((e=>e?e.forEach?[...e]:e.nodeType?[e]:[new Text(e)]:[new Text(e)])):[new Text],this.#s=e(this.parentNode,this.#s,t,this.nextSibling)}replaceHTML(e){const t=this.parentNode.cloneNode();t.innerHTML=e,this.replace(t.childNodes)}}const o={},l=(e,t=[])=>{let r,s,o,c,p;for(r of e.attributes||[])if(r.value.includes("{{")){for([c,p]of(o={element:e,attr:r,parts:[]},i(r.value)))c?(p=new a(o,p),o.parts.push(p),t.push(p)):o.parts.push(p);r.value=o.parts.join("")}for(s of e.childNodes)if(1===s.nodeType)l(s,t);else if((3===s.nodeType||8===s.nodeType)&&s.data.includes("{{")){for([c,p]of(o={parentNode:e,parts:[]},i(s.data.trim())))c?(p=new n(o,p),o.parts.push(p),t.push(p)):o.parts.push(new Text(p));s.replaceWith(...o.parts.flatMap((e=>e.replacementNodes||[e])))}return t},i=e=>{let t,r="",s=0,a=o[e],n=0;if(a)return a;for(a=[];t=e[n];n++)"{"===t&&"{"===e[n+1]&&"\\"!==e[n-1]&&e[n+2]&&1==++s?(r&&a.push([0,r]),r="",n++):"}"!==t||"}"!==e[n+1]||"\\"===e[n-1]||--s?r+=e[n]||"":(a.push([1,r.trim()]),r="",n++);return r&&a.push([0,r]),o[e]=a};let c,p,u,h,d,f,b,m=(e,t=(p=e,c=0,u=[],!(e=x())||p[c]?v():t=>e(t||{})))=>(t.args=u,t),g=e=>e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122||36==e||95==e||e>=192&&215!=e&&247!=e,v=(e="Bad syntax",t=p[c])=>{throw SyntaxError(e+" `"+t+"` at "+c)},y=(e=1,t=c,r)=>{if("number"==typeof e)c+=e;else for(;e(p.charCodeAt(c));)c++;return p.slice(t,c)},x=(e=0,t,r,s,a,n)=>{for(;(r=C())&&(a=(n=S[r])&&n(s,e)||!s&&w());)s=a;return t&&(r==t?c++:v()),s},C=e=>{for(;(e=p.charCodeAt(c))<=32;)c++;return e},w=(e=y(g),t)=>e?(t=t=>t[e],u.push(e),t.id=()=>e,t):0,S=[],N=m.set=(e,t,r=32,s=e.charCodeAt(0),a=e.length,n=S[s],o=r.length||([r,t]=[t,r],0),l=e.toUpperCase()!==e,i=(o>1?(e,s)=>e&&(s=x(t))&&(e.length||s.length?t=>r(e(t),s(t),e.id?.(t),s.id?.(t)):(e=r(e(),s()),()=>e)):o?e=>!e&&(e=x(t-1))&&(t=>r(e(t))):r))=>S[s]=(r,s,o=c)=>s<t&&(a<2||p.substr(c,a)==e)&&(!l||!g(p.charCodeAt(c+a)))&&(c+=a,i(r,s))||(c=o,n&&n(r,s)),k=e=>e>=48&&e<=57,A=e=>(e&&v("Unexpected number"),e=y((e=>46==e||k(e))),(69==p.charCodeAt(c)||101==p.charCodeAt(c))&&(e+=y(2)+y(k)),(e=+e)!=e?v("Bad number"):()=>e),T=(e,t)=>r=>t(e.of?e.of(r):r,e.id(r));for(d=48;d<=57;)S[d++]=A;for(h=['"',e=>(e=e?v("Unexpected string"):y((e=>e-34)),y()||v("Bad string"),()=>e),,".",(e,t)=>(C(),t=y(g)||v(),b=r=>e(r)[t],b.id=()=>t,b.of=e,b),18,".",e=>!e&&A(y(-1)),,"[",(e,t,r)=>e&&(t=x(0,93)||v(),(r=r=>e(r)[t(r)]).id=t,r.of=e,r),18,"(",(e,t,r)=>(t=x(0,41),e?r=>e(r).apply(e.of?.(r),t?t.all?t.all(r):[t(r)]:[]):t||v()),18,",",(e,t,r=x(1),s=(t=>(e(t),r(t))))=>(r?s.all=e.all?t=>[...e.all(t),r(t)]:t=>[e(t),r(t)]:v("Skipped argument"),s),1,"|",6,(e,t)=>e|t,"||",4,(e,t)=>e||t,"&",8,(e,t)=>e&t,"&&",5,(e,t)=>e&&t,"^",7,(e,t)=>e^t,"==",9,(e,t)=>e==t,"!=",9,(e,t)=>e!=t,">",10,(e,t)=>e>t,">=",10,(e,t)=>e>=t,">>",11,(e,t)=>e>>t,">>>",11,(e,t)=>e>>>t,"<",10,(e,t)=>e<t,"<=",10,(e,t)=>e<=t,"<<",11,(e,t)=>e<<t,"+",12,(e,t)=>e+t,"+",15,e=>+e,"++",e=>T(e||x(14),e?(e,t)=>e[t]++:(e,t)=>++e[t]),15,"-",12,(e,t)=>e-t,"-",15,e=>-e,"--",e=>T(e||x(14),e?(e,t)=>e[t]--:(e,t)=>--e[t]),15,"!",15,e=>!e,"*",13,(e,t)=>e*t,"/",13,(e,t)=>e/t,"%",13,(e,t)=>e%t];[d,f,b,...h]=h,d;)N(d,f,b);Symbol.observable||=Symbol("observable");const j=new FinalizationRegistry((e=>e.call?.()));var U=(e,t,r,s,a,n)=>e&&(n=e.subscribe?.(t,r,s)||e[Symbol.observable]?.().subscribe?.(t,r,s)||e.set&&e.call?.(a,t)||(e.then?.((e=>(!a&&t(e),s?.())),r)||(async n=>{try{for await(n of e){if(a)return;t(n)}s?.()}catch(e){r?.(e)}})())&&(e=>a=1),j.register(e,n),n);const M=(e,t,r,s)=>(e[t="on"===t.slice(0,2)?t.toLowerCase():t]!==r&&(!(t in e.constructor.prototype)||!(s=Object.getOwnPropertyDescriptor(e.constructor.prototype,t))||s.set)&&(e[t]=r),!1===r||null==r?e.removeAttribute(t):"function"!=typeof r&&e.setAttribute(t,!0===r?"":"number"==typeof r||"string"==typeof r?r:"class"===t&&Array.isArray(r)?r.filter(Boolean).join(" "):"style"===t&&r.constructor===Object&&(t=r,r=Object.values(r),Object.keys(t).map(((e,t)=>`${e}: ${r[t]};`)).join(" "))));m.set(":",3.1,((e,t)=>[e,t])),m.set("?",3,((e,t)=>e?t[0]:t[1])),m.set("true",(e=>{if(e)throw new SyntaxError("Unexpected");return()=>!0})),m.set("false",(e=>{if(e)throw new SyntaxError("Unexpected");return()=>!1})),m.set("?.",18,((e,t,r,s)=>e?.[s])),m.set("|",6,((e,t)=>t(e)));const O=new WeakMap,R=new FinalizationRegistry((([e,t])=>(e[t]?.(),delete e[t])));var B={createCallback(e,t,r){if(O.get(e))return;let s,a,n,o={},l={},i={};for(s of t)(s.evaluate=m(s.expression)).args.map((e=>(o[e]||=[]).push(s)));for(let t in r)(c=n=r[t])&&(c[Symbol.observable]||c[Symbol.asyncIterator]||c.call&&c.set||c.subscribe||c.then)?(i[t]=U(n,(r=>(l[t]=r,a&&this.processCallback(e,o[t],{[t]:r})))),R.register(n,[i,t])):l[t]=n;var c;a=!0,O.set(e,[l,i])},processCallback(e,t,r){let s,a,n,[o,l]=O.get(e);for(s in r)l[s]||(o[s]=r[s]);for(a of t)(n=a.evaluate(o))!==a.value&&(a.attributeName&&1===a.setter.parts.length?M(a.element,a.attributeName,a.value=n):a.value=n)}},E=(e,t,r=B)=>{let s,a=l(e),n=()=>{s||(r.processCallback(e,a,t),s=Promise.resolve().then((()=>(s=null,r.processCallback(e,a,t)))))};return t||={},r.createCallback?.(e,a,t),r.processCallback(e,a,t),new Proxy(t,{set:(e,t,r)=>(e[t]=r,n(),1),deleteProperty:(e,t)=>(delete e[t],n())})};export{a as AttributeTemplatePart,n as NodeTemplatePart,r as TemplateInstance,s as TemplatePart,E as default,B as processor};