const e=(t,s,r,a=null)=>{let n,o,l,i=0,p=r.length,c=s.length,{remove:h,same:u,insert:d,replace:b}=e;for(;i<p&&i<c&&u(s[i],r[i]);)i++;for(;i<p&&i<c&&u(r[p-1],s[c-1]);)a=r[(--c,--p)];if(i==c)for(;i<p;)d(a,r[i++],t);else{for(n=s[i];i<p;)l=r[i++],o=n?n.nextSibling:a,u(n,l)?n=o:i<p&&u(r[i],o)?(b(n,l,t),n=o):d(n,l,t);for(;n!=a;)o=n.nextSibling,h(n,t),n=o}return r};e.same=(e,t)=>e==t,e.replace=(e,t,s)=>s.replaceChild(t,e),e.insert=(e,t,s)=>s.insertBefore(t,e),e.remove=(e,t)=>t.removeChild(e);const t={processCallback(e,t,s){if(s)for(const e of t)e.expression in s&&(e.value=s[e.expression])}};class s extends DocumentFragment{#e;#t;constructor(e,s,r=t){super(),this.appendChild(e.content.cloneNode(!0)),this.#e=l(this),this.#t=r,s||={},r.createCallback?.(this,this.#e,s),r.processCallback(this,this.#e,s)}update(e){this.#t.processCallback(this,this.#e,e)}}class r{constructor(e,t){this.setter=e,this.expression=t}toString(){return this.value}}class a extends r{#s="";get attributeName(){return this.setter.attr.name}get attributeNamespace(){return this.setter.attr.namespaceURI}get element(){return this.setter.element}get value(){return this.#s}set value(e){this.#s=e;const{attr:t,element:s,parts:r}=this.setter;1===r.length?null==e?s.removeAttributeNS(t.namespaceURI,t.name):s.setAttributeNS(t.namespaceURI,t.name,e):s.setAttributeNS(t.namespaceURI,t.name,r.join(""))}get booleanValue(){this.setter.element.hasAttribute(this.setter.attr.name)}set booleanValue(e){if(1!==this.setter.parts.length)throw new DOMException("Value is not fully templatized");this.value=e?"":null}}class n extends r{#r=[new Text];get replacementNodes(){return this.#r}get parentNode(){return this.setter.parentNode}get nextSibling(){return this.#r[this.#r.length-1].nextSibling}get previousSibling(){return this.#r[0].previousSibling}get value(){return this.#r.map((e=>e.textContent)).join("")}set value(e){this.replace(e)}replace(...t){t=t.length?t.flatMap((e=>e?e.forEach?[...e]:e.nodeType?[e]:[new Text(e)]:[new Text(e)])):[new Text],this.#r=e(this.parentNode,this.#r,t,this.nextSibling)}replaceHTML(e){const t=this.parentNode.cloneNode();t.innerHTML=e,this.replace(t.childNodes)}}const o={},l=(e,t=[])=>{let s,r,o,p,c;for(s of e.attributes||[])if(s.value.includes("{{")){for([p,c]of(o={element:e,attr:s,parts:[]},i(s.value)))p?(c=new a(o,c),o.parts.push(c),t.push(c)):o.parts.push(c);s.value=o.parts.join("")}for(r of e.childNodes)if(1===r.nodeType)l(r,t);else if((3===r.nodeType||8===r.nodeType)&&r.data.includes("{{")){for([p,c]of(o={parentNode:e,parts:[]},i(r.data.trim())))p?(c=new n(o,c),o.parts.push(c),t.push(c)):o.parts.push(new Text(c));r.replaceWith(...o.parts.flatMap((e=>e.replacementNodes||[e])))}return t},i=e=>{let t,s="",r=0,a=o[e],n=0;if(a)return a;for(a=[];t=e[n];n++)"{"===t&&"{"===e[n+1]&&"\\"!==e[n-1]&&e[n+2]&&1==++r?(s&&a.push([0,s]),s="",n++):"}"!==t||"}"!==e[n+1]||"\\"===e[n-1]||--r?s+=e[n]||"":(a.push([1,s.trim()]),s="",n++);return s&&a.push([0,s]),o[e]=a};let p,c,h,u,d,b,f,m=(e,t=(c=e,p=0,h=[],!(e=x())||c[p]?y():t=>e(t||{})))=>(t.args=h,t),g=e=>e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122||36==e||95==e||e>=192&&215!=e&&247!=e,y=(e="Bad syntax",t=c[p])=>{throw SyntaxError(e+" `"+t+"` at "+p)},v=(e=1,t=p,s)=>{if("number"==typeof e)p+=e;else for(;e(c.charCodeAt(p));)p++;return c.slice(t,p)},x=(e=0,t,s,r,a,n)=>{for(;(s=S())&&(a=(n=w[s])&&n(r,e)||!r&&C());)r=a;return t&&(s==t?p++:y()),r},S=e=>{for(;(e=c.charCodeAt(p))<=32;)p++;return e},C=(e=v(g),t)=>e?(t=t=>t[e],h.push(e),t.id=()=>e,t):0,w=[],N=m.set=(e,t,s=32,r=e.charCodeAt(0),a=e.length,n=w[r],o=s.length||([s,t]=[t,s],0),l=e.toUpperCase()!==e,i=(o>1?(e,r)=>e&&(r=x(t))&&(e.length||r.length?t=>s(e(t),r(t),e.id?.(t),r.id?.(t)):(e=s(e(),r()),()=>e)):o?e=>!e&&(e=x(t-1))&&(t=>s(e(t))):s))=>w[r]=(s,r,o=p)=>r<t&&(a<2||c.substr(p,a)==e)&&(!l||!g(c.charCodeAt(p+a)))&&(p+=a,i(s,r))||(p=o,n&&n(s,r)),k=e=>e>=48&&e<=57,T=e=>(e&&y("Unexpected number"),e=v((e=>46==e||k(e))),(69==c.charCodeAt(p)||101==c.charCodeAt(p))&&(e+=v(2)+v(k)),(e=+e)!=e?y("Bad number"):()=>e),A=(e,t)=>s=>t(e.of?e.of(s):s,e.id(s));for(d=48;d<=57;)w[d++]=T;for(u=['"',e=>(e=e?y("Unexpected string"):v((e=>e-34)),v()||y("Bad string"),()=>e),,".",(e,t)=>(S(),t=v(g)||y(),f=s=>e(s)[t],f.id=()=>t,f.of=e,f),18,".",e=>!e&&T(v(-1)),,"[",(e,t,s)=>e&&(t=x(0,93)||y(),(s=s=>e(s)[t(s)]).id=t,s.of=e,s),18,"(",(e,t,s)=>(t=x(0,41),e?s=>e(s).apply(e.of?.(s),t?t.all?t.all(s):[t(s)]:[]):t||y()),18,",",(e,t,s=x(1))=>(s.all=e.all?t=>[...e.all(t),s(t)]:t=>[e(t),s(t)],s),1,"|",6,(e,t)=>e|t,"||",4,(e,t)=>e||t,"&",8,(e,t)=>e&t,"&&",5,(e,t)=>e&&t,"^",7,(e,t)=>e^t,"==",9,(e,t)=>e==t,"!=",9,(e,t)=>e!=t,">",10,(e,t)=>e>t,">=",10,(e,t)=>e>=t,">>",11,(e,t)=>e>>t,">>>",11,(e,t)=>e>>>t,"<",10,(e,t)=>e<t,"<=",10,(e,t)=>e<=t,"<<",11,(e,t)=>e<<t,"+",12,(e,t)=>e+t,"+",15,e=>+e,"++",e=>A(e||x(14),e?(e,t)=>e[t]++:(e,t)=>++e[t]),15,"-",12,(e,t)=>e-t,"-",15,e=>-e,"--",e=>A(e||x(14),e?(e,t)=>e[t]--:(e,t)=>--e[t]),15,"!",15,e=>!e,"*",13,(e,t)=>e*t,"/",13,(e,t)=>e/t,"%",13,(e,t)=>e%t];[d,b,f,...u]=u,d;)N(d,b,f);Symbol.observable||=Symbol("observable");const U=e=>e&&!!(e[Symbol.observable]||e[Symbol.asyncIterator]||e.call&&e.set||e.subscribe||e.then);var E=(e,t,s,r,a)=>e&&(e.subscribe?.(t,s,r)||e[Symbol.observable]?.().subscribe?.(t,s,r)||e.set&&e.call?.(a,(e=>{try{t(e)}catch(e){s?.(e)}}))||(e.then?.((e=>(!a&&t(e),r?.())),s)||(async n=>{try{for await(e of e){if(a)return;t(e)}r?.()}catch(e){s?.(e)}})())&&(e=>a=1));m.set(":",3.1,((e,t)=>[e,t])),m.set("?",3,((e,t)=>e?t[0]:t[1])),m.set("true",(e=>{if(e)throw new SyntaxError("Unexpected");return()=>!0})),m.set("false",(e=>{if(e)throw new SyntaxError("Unexpected");return()=>!1})),m.set("?.",18,((e,t,s,r)=>e?.[r])),m.set("|",6,((e,t)=>t(e)));const I=Symbol("params"),M=Symbol("init");Symbol.dispose||=Symbol("dispose");var j={createCallback(e,t,s){e[I]=s;for(const e of t)e.evaluate=m(e.expression);let r,a=[];for(const n in s)U(r=s[n])&&(s[n]="",a.push(E(r,(s=>this.processCallback(e,t,{[n]:s})))));const n=e[Symbol.dispose];e[Symbol.dispose]=()=>(a.map((e=>e())),n?.()),e[M]=!0},processCallback(e,t,s){if(Object.assign(e[I],s),e[M])for(const s of t)s.value=s.evaluate(e[I])}},B=(e,t,s=j)=>{(t||={})[Symbol.dispose]=e[Symbol.dispose];let r,a=l(e),n=()=>{r||(s.processCallback(e,a,t),r=Promise.resolve().then((()=>(r=null,s.processCallback(e,a,t)))))};return s.createCallback?.(e,a,t),s.processCallback(e,a,t),new Proxy(t,{set:(e,t,s)=>(e[t]=s,n(),1),deleteProperty:(e,t)=>(delete e[t],n())})};export{a as AttributeTemplatePart,n as NodeTemplatePart,s as TemplateInstance,r as TemplatePart,B as default,j as processor};