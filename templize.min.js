let e,t,r,s,a,n,l,o=(s,a)=>(e=0,r=[],t=s.trim(),!(s=t?u():e=>{})||t[e]?c():a=e=>s(e||{}),a.args=r,a),i=e=>e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122||36==e||95==e||e>=192&&215!=e&&247!=e,c=(r="Bad syntax",s=t[e])=>{throw SyntaxError(r+" `"+s+"` at "+e)},p=(r=1,s=e,a)=>{if("number"==typeof r)e+=r;else for(;r(t.charCodeAt(e));)e++;return t.slice(s,e)},u=(t=0,r,s,a,n,l)=>{for(;(s=h())&&(n=(l=f[s])&&l(a,t)||!a&&d());)a=n;return r&&(s==r?e++:c()),a},h=r=>{for(;(r=t.charCodeAt(e))<=32;)e++;return r},d=(e=p(i),t)=>e?(t=t=>t[e],r.push(e),t.id=()=>e,t):0,f=[],b=o.set=(r,s,a=32,n=r.charCodeAt(0),l=r.length,o=f[n],c=a.length||([a,s]=[s,a],0),p=r.toUpperCase()!==r,h=(c>1?(e,t)=>e&&(t=u(s))&&(e.length||t.length?r=>a(e(r),t(r),e.id?.(r),t.id?.(r)):(e=a(e(),t()),()=>e)):c?e=>!e&&(e=u(s-1))&&(t=>a(e(t))):a))=>f[n]=(a,n,c=e)=>n<s&&(l<2||t.substr(e,l)==r)&&(!p||!i(t.charCodeAt(e+l)))&&(e+=l,h(a,n))||(e=c,o&&o(a,n)),m=e=>e>=48&&e<=57,g=r=>(r&&c("Unexpected number"),r=p((e=>46==e||m(e))),(69==t.charCodeAt(e)||101==t.charCodeAt(e))&&(r+=p(2)+p(m)),(r=+r)!=r?c("Bad number"):()=>r),v=(e,t)=>r=>t(e.of?e.of(r):r,e.id(r));for(a=48;a<=57;)f[a++]=g;for(s=['"',e=>(e=e?c("Unexpected string"):p((e=>e-34)),p()||c("Bad string"),()=>e),,".",(e,t)=>(h(),t=p(i)||c(),l=r=>e(r)[t],l.id=()=>t,l.of=e,l),18,".",e=>!e&&g(p(-1)),,"[",(e,t,r)=>e&&(t=u(0,93)||c(),(r=r=>e(r)[t(r)]).id=t,r.of=e,r),18,"(",(e,t,r)=>(t=u(0,41),e?r=>e(r).apply(e.of?.(r),t?t.all?t.all(r):[t(r)]:[]):t||c()),18,",",(e,t,r=u(1),s=(t=>(e(t),r(t))))=>(r?s.all=e.all?t=>[...e.all(t),r(t)]:t=>[e(t),r(t)]:c("Skipped argument"),s),1,"|",6,(e,t)=>e|t,"||",4,(e,t)=>e||t,"&",8,(e,t)=>e&t,"&&",5,(e,t)=>e&&t,"^",7,(e,t)=>e^t,"==",9,(e,t)=>e==t,"!=",9,(e,t)=>e!=t,">",10,(e,t)=>e>t,">=",10,(e,t)=>e>=t,">>",11,(e,t)=>e>>t,">>>",11,(e,t)=>e>>>t,"<",10,(e,t)=>e<t,"<=",10,(e,t)=>e<=t,"<<",11,(e,t)=>e<<t,"+",12,(e,t)=>e+t,"+",15,e=>+e,"++",e=>v(e||u(14),e?(e,t)=>e[t]++:(e,t)=>++e[t]),15,"-",12,(e,t)=>e-t,"-",15,e=>-e,"--",e=>v(e||u(14),e?(e,t)=>e[t]--:(e,t)=>--e[t]),15,"!",15,e=>!e,"*",13,(e,t)=>e*t,"/",13,(e,t)=>e/t,"%",13,(e,t)=>e%t];[a,n,l,...s]=s,a;)b(a,n,l);Symbol.observable||=Symbol("observable");const y=e=>e&&!!(e[Symbol.observable]||e[Symbol.asyncIterator]||e.call&&e.set||e.subscribe||e.then),x=new FinalizationRegistry((e=>e.call?.()));var C=(e,t,r,s,a,n)=>{return e&&(l=(e[Symbol.observable]?.()||e).subscribe?.(t,r,s),n=l&&(()=>l.unsubscribe?.())||e.set&&e.call?.(a,t)||(e.then?.((e=>(!a&&t(e),s?.())),r)||(async n=>{try{for await(n of e){if(a)return;t(n)}s?.()}catch(e){r?.(e)}})())&&(e=>a=1),x.register(e,n),n);var l};const w=(e,t,r,s)=>(e[t="on"===t.slice(0,2)?t.toLowerCase():t]!==r&&(!(t in e.constructor.prototype)||!(s=Object.getOwnPropertyDescriptor(e.constructor.prototype,t))||s.set)&&(e[t]=r),!1===r||null==r?e.removeAttribute(t):"function"!=typeof r&&e.setAttribute(t,!0===r?"":"number"==typeof r||"string"==typeof r?r:"class"===t&&Array.isArray(r)?r.filter(Boolean).join(" "):"style"===t&&r.constructor===Object?(t=r,r=Object.values(r),Object.keys(t).map(((e,t)=>`${e}: ${r[t]};`)).join(" ")):"")),A=(e,t,r,s=null)=>{let a,n,l,o=0,i=r.length,c=t.length,{remove:p,same:u,insert:h,replace:d}=A;for(;o<i&&o<c&&u(t[o],r[o]);)o++;for(;o<i&&o<c&&u(r[i-1],t[c-1]);)s=r[(--c,--i)];if(o==c)for(;o<i;)h(s,r[o++],e);else{for(a=t[o];o<i;)l=r[o++],n=a?a.nextSibling:s,u(a,l)?a=n:o<i&&u(r[o],n)?(d(a,l,e),a=n):h(a,l,e);for(;!u(a,s);)n=a.nextSibling,p(a,e),a=n}return r};A.same=(e,t)=>e==t,A.replace=(e,t,r)=>r.replaceChild(t,e),A.insert=(e,t,r)=>r.insertBefore(t,e),A.remove=(e,t)=>t.removeChild(e);const S={processCallback(e,t,r){if(r)for(const e of t)e.expression in r&&(e.value=r[e.expression])}};class N extends DocumentFragment{#e;#t;constructor(e,t,r=S){super(),this.appendChild(e.content.cloneNode(!0)),this.#e=U(this),this.#t=r,t||={},r.createCallback?.(this,this.#e,t),r.processCallback(this,this.#e,t)}update(e){this.#t.processCallback(this,this.#e,e)}}class T{constructor(e,t){this.setter=e,this.expression=t}toString(){return this.value}}class k extends T{#r="";get attributeName(){return this.setter.attr.name}get attributeNamespace(){return this.setter.attr.namespaceURI}get element(){return this.setter.element}get value(){return this.#r}set value(e){if(this.#r===e)return;this.#r=e;const{attr:t,element:r,parts:s}=this.setter;1===s.length?null==e?r.removeAttributeNS(t.namespaceURI,t.name):r.setAttributeNS(t.namespaceURI,t.name,e):r.setAttributeNS(t.namespaceURI,t.name,s.join(""))}get booleanValue(){this.setter.element.hasAttribute(this.setter.attr.name)}set booleanValue(e){if(1!==this.setter.parts.length)throw new DOMException("Value is not fully templatized");this.value=e?"":null}}class j extends T{#s=[new Text];get replacementNodes(){return this.#s}get parentNode(){return this.setter.parentNode}get nextSibling(){return this.#s[this.#s.length-1].nextSibling}get previousSibling(){return this.#s[0].previousSibling}get value(){return this.#s.map((e=>e.textContent)).join("")}set value(e){this.replace(e)}replace(...e){(e=e.flat().flatMap((e=>null==e?[new Text]:e.forEach?[...e]:11===e.nodeType?[...e.childNodes]:e.nodeType?[e]:[new Text(e)]))).length||e.push(new Text),this.#s=A(this.#s[0].parentNode,this.#s,e,this.nextSibling)}replaceHTML(e){const t=this.parentNode.cloneNode();t.innerHTML=e,this.replace(t.childNodes)}}class O extends j{directive;constructor(e,t){let r=t.getAttribute("directive")||t.getAttribute("type"),s=t.getAttribute("expression")||t.getAttribute(r)||"";s.startsWith("{{")&&(s=s.trim().slice(2,-2).trim()),super(e,s),this.template=t,this.directive=r}}const U=(e,t=[])=>{let r,s,a,n,l;for(r of e.attributes||[])if(r.value.includes("{{")){for([n,l]of(a={element:e,attr:r,parts:[]},E(r.value)))n?(l=new k(a,l),a.parts.push(l),t.push(l)):a.parts.push(l);r.value=a.parts.join("")}for(s of e.childNodes)if(1!==s.nodeType||s instanceof HTMLTemplateElement){if(1===s.nodeType||s.data.includes("{{")){const r={parentNode:e,parts:[]};if(s.data)for([n,l]of E(s.data.trim()))n?(l=new j(r,l),r.parts.push(l),t.push(l)):r.parts.push(new Text(l));else l=new O(r,s),r.parts.push(l),t.push(l);s.replaceWith(...r.parts.flatMap((e=>e.replacementNodes||[e])))}}else U(s,t);return t},E=e=>{let t,r="",s=0,a=M[e],n=0;if(a)return a;for(a=[];t=e[n];n++)"{"===t&&"{"===e[n+1]&&"\\"!==e[n-1]&&e[n+2]&&1==++s?(r&&a.push([0,r]),r="",n++):"}"!==t||"}"!==e[n+1]||"\\"===e[n-1]||--s?r+=e[n]||"":(a.push([1,r.trim()]),r="",n++);return r&&a.push([0,r]),M[e]=a},M={},P={n:"\n",r:"\r",t:"\t",b:"\b",f:"\f",v:"\v"},B=r=>(s,a,n="")=>{for(;(a=t.charCodeAt(e))-r;)92===a?(p(),a=p(),n+=P[a]||a):n+=p();return p()||c("Bad string"),()=>n};o.set('"',B(34)),o.set("'",B(39)),o.set(":",3.1,((e,t)=>[e,t])),o.set("?",3,((e,t)=>e?t[0]:t[1])),o.set("true",(e=>{if(e)throw new SyntaxError("Unexpected");return()=>!0})),o.set("false",(e=>{if(e)throw new SyntaxError("Unexpected");return()=>!1})),o.set("?.",18,((e,t,r,s)=>e?.[s])),o.set("|",6,((e,t)=>t(e))),o.set("in",((e,t)=>(t=u(),r=>[e.id(r),t(r)])));const I=new WeakMap,R={createCallback(e,t,r){if(I.get(e))return;let s,a,n={},l={},i=(t,r,l)=>{for(let o in t)y(s=t[o])?W.register(s,C(s,(t=>(r[o]=t,a&&this.processCallback(e,n[l||o]))))):s?.constructor===Object?i(s,r[o]={},l||o):r[o]=s};for(const s of t)(s.eval=o(s.expression)).args.map((e=>(n[e]||=[]).push(s))),z[s.directive]?.create(e,s,r);i(r,l),I.set(e,[l]),a=!0},processCallback(e,t,r){let s,a,[n]=I.get(e);for(s of(L(n,r),t))(a=s.eval(n))!==s.value&&(s.replace?s.replace(a):1===s.setter.parts.length?w(s.element,s.attributeName,s.value=a):s.value=a)}},W=new FinalizationRegistry((e=>e?.call?.())),L=(e,t)=>{for(let r in t)r in e&&(t[r]?.constructor==Object?L(e[r],t[r]):!y(t[r])&&(e[r]=t[r]))},z={},D=(e,t)=>z[e]={prepare(t,r=t.querySelectorAll(`[\\:${e}]`),s,a,n){for(t of r)t.replaceWith(s=new Text),(a=document.createElement("template")).content.appendChild(t),a.setAttribute("directive",e),n=t.getAttribute(":"+e),a.setAttribute("expression",n.slice(n.indexOf("{{")+2,n.lastIndexOf("}}"))),t.removeAttribute(":"+e),s.replaceWith(a)},create:t};D("if",((e,t)=>{(t.addCase=(e,r=e.eval)=>e.eval=s=>t.match?"":r(s)?(t.match=e,new N(e.template,s,R)):"")(e.ifPart=t);const r=t.eval;t.eval=e=>(t.match=null,r(e))})),D("else-if",((e,t)=>e.ifPart?.addCase(t))),D("else",((e,t)=>(t.eval=()=>!0,e.ifPart?.addCase(t),e.ifPart=null))),D("each",((e,t)=>{let r=t.eval;t.eval=e=>{let[s,a]=r(e),n=[];for(let r of a)n.push(new N(t.template,{...e,[s]:r},R));return n}}));var F=(e,t,r=R)=>{for(let t in z)z[t].prepare(e);let s,a=U(e),n=t=>r.processCallback(e,a,t);return t||={},r.createCallback?.(e,a,t),r.processCallback(e,a,t),t[Symbol.iterator]=function*(){yield s,yield n,yield a},s=new Proxy(t,{set:(e,r,s)=>(t[r]=s,n(t),1),deleteProperty:(e,r)=>(delete t[r],n(),1)})};export{k as AttributeTemplatePart,O as InnerTemplatePart,j as NodeTemplatePart,N as TemplateInstance,T as TemplatePart,F as default,S as defaultProcessor,U as parse,R as processor,E as tokenize};