const e={processCallback(e,t,s){if(s)for(const e of t)e.expression in s&&(e.value=s[e.expression])}};class t extends DocumentFragment{#e;#t;constructor(t,s,r=e){super(),this.appendChild(t.content.cloneNode(!0)),this.#e=o(this),this.#t=r,r.createCallback?.(this,this.#e,s),r.processCallback?.(this,this.#e,s)}update(e){this.#t.processCallback?.(this,this.#e,e)}}class s{constructor(e,t){this.setter=e,this.expression=t}toString(){return this.value}}class r extends s{#s="";get attributeName(){return this.setter.attr.name}get attributeNamespace(){return this.setter.attr.namespaceURI}get element(){return this.setter.element}get value(){return this.#s}set value(e){this.#s=e;const{attr:t,element:s,parts:r}=this.setter;1===r.length?null==e?s.removeAttributeNS(t.namespaceURI,t.name):s.setAttributeNS(t.namespaceURI,t.name,e):s.setAttributeNS(t.namespaceURI,t.name,r.join(""))}get booleanValue(){this.setter.element.hasAttribute(this.setter.attr.name)}set booleanValue(e){if(1!==this.setter.parts.length)throw new DOMException("Value is not fully templatized");this.value=e?"":null}}class n extends s{#r=[new Text];get replacementNodes(){return this.#r}get parentNode(){return this.setter.parentNode}get nextSibling(){return this.#r[this.#r.length-1].nextSibling}get previousSibling(){return this.#r[0].previousSibling}get value(){return this.#r.map((e=>e.textContent)).join("")}set value(e){this.replace(e)}replace(...e){e=e.length?e.flatMap((e=>e?e.forEach?[...e]:e.nodeType?[e]:[new Text(e)]:new Text)):[new Text],this.#r=((e,t,s,r=null)=>{let n,a,l,o=0,i=s.length,p=t.length;for(;o<i&&o<p&&t[o]==s[o];)o++;for(;o<i&&o<p&&s[i-1]==t[p-1];)r=s[(--p,--i)];if(o==p)for(;o<i;)e.insertBefore(s[o++],r);else{for(n=t[o];o<i;)l=s[o++],a=n?n.nextSibling:r,n==l?n=a:o<i&&s[o]==a?(e.replaceChild(l,n),n=a):e.insertBefore(l,n);for(;n!=r;)a=n.nextSibling,e.removeChild(n),n=a}return s})(this.parentNode,this.#r,e,this.nextSibling)}replaceHTML(e){const t=this.parentNode.cloneNode();t.innerHTML=e,this.replace(t.childNodes)}}const a={},l=["caption","colgroup","thead","tbody","tfoot","tr"].map((e=>e+":empty"))+"",o=(e,t=[])=>{let s,a,p,h,u,c,d,f,g;for(s of e.attributes||[])if(s.value.includes("{{")){for([h,u]of(p={element:e,attr:s,parts:[]},i(s.value)))h?(u=new r(p,u),p.parts.push(u),t.push(u)):p.parts.push(u);s.value=p.parts.join("")}for(a of e.childNodes)if(1===a.nodeType)o(a,t);else if(3===a.nodeType&&a.data.includes("{{")){for([h,u]of(p={parentNode:e,parts:[]},i(a.data.trim())))h?(u=new n(p,u),p.parts.push(u),t.push(u)):p.parts.push(new Text(u));if("TABLE"===(c=a.nextSibling)?.tagName){for(g=c.matches(":empty")?[c]:c.querySelectorAll(l),d=[];d.length<g.length&&p.parts[p.parts.length-1]instanceof n;)d.push(p.parts.pop());for(f of g)d.length&&(t.pop(),p.parts.pop(),f.appendChild(new Text(`{{ ${d.pop().expression} }}`)),p.parts.push(new Text))}a.replaceWith(...p.parts.flatMap((e=>e.replacementNodes||[e])))}return t},i=e=>{let t,s="",r=0,n=a[e],l=0;if(n)return n;for(n=[];t=e[l];l++)"{"===t&&"{"===e[l+1]&&"\\"!==e[l-1]&&e[l+2]&&1==++r?(s&&n.push([0,s]),s="",l++):"}"!==t||"}"!==e[l+1]||"\\"===e[l-1]||--r?s+=e[l]||"":(n.push([1,s.trim()]),s="",l++);return s&&n.push([0,s]),a[e]=n};var p=(t,s={},r=e)=>{let n,a=o(t),l=()=>{n||(r.processCallback?.(t,a,s),n=Promise.resolve().then((()=>(n=null,r.processCallback?.(t,a,s)))))};return r.createCallback?.(t,a,s),r.processCallback?.(t,a,s),new Proxy(s,{set:(e,t,s)=>(e[t]=s,l(),1),deleteProperty:(e,t)=>(delete e[t],l())})};export{r as AttributeTemplatePart,n as NodeTemplatePart,t as TemplateInstance,s as TemplatePart,p as default,e as values};