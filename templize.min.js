const e=(t,s,r,a=null)=>{let o,n,l,i=0,p=r.length,c=s.length,{remove:u,same:h,insert:b,replace:d}=e;for(;i<p&&i<c&&h(s[i],r[i]);)i++;for(;i<p&&i<c&&h(r[p-1],s[c-1]);)a=r[(--c,--p)];if(i==c)for(;i<p;)b(a,r[i++],t);else{for(o=s[i];i<p;)l=r[i++],n=o?o.nextSibling:a,h(o,l)?o=n:i<p&&h(r[i],n)?(d(o,l,t),o=n):b(o,l,t);for(;!h(o,a);)n=o.nextSibling,u(o,t),o=n}return r};e.same=(e,t)=>e==t,e.replace=(e,t,s)=>s.replaceChild(t,e),e.insert=(e,t,s)=>s.insertBefore(t,e),e.remove=(e,t)=>t.removeChild(e);const t={processCallback(e,t,s){if(s)for(const e of t)e.expression in s&&(e.value=s[e.expression])}};class s extends DocumentFragment{#e;#t;constructor(e,s,r=t){super(),this.appendChild(e.content.cloneNode(!0)),this.#e=l(this),this.#t=r,s||={},r.createCallback?.(this,this.#e,s),r.processCallback(this,this.#e,s)}update(e){this.#t.processCallback(this,this.#e,e)}}class r{constructor(e,t){this.setter=e,this.expression=t}toString(){return this.value}}class a extends r{#s="";get attributeName(){return this.setter.attr.name}get attributeNamespace(){return this.setter.attr.namespaceURI}get element(){return this.setter.element}get value(){return this.#s}set value(e){if(this.#s===e)return;this.#s=e;const{attr:t,element:s,parts:r}=this.setter;1===r.length?null==e?s.removeAttributeNS(t.namespaceURI,t.name):s.setAttributeNS(t.namespaceURI,t.name,e):s.setAttributeNS(t.namespaceURI,t.name,r.join(""))}get booleanValue(){this.setter.element.hasAttribute(this.setter.attr.name)}set booleanValue(e){if(1!==this.setter.parts.length)throw new DOMException("Value is not fully templatized");this.value=e?"":null}}class o extends r{#r=[new Text];get replacementNodes(){return this.#r}get parentNode(){return this.setter.parentNode}get nextSibling(){return this.#r[this.#r.length-1].nextSibling}get previousSibling(){return this.#r[0].previousSibling}get value(){return this.#r.map((e=>e.textContent)).join("")}set value(e){this.replace(e)}replace(...t){t=t.length?t.flatMap((e=>e?e.forEach?[...e]:e.nodeType?[e]:[new Text(e)]:[new Text(e)])):[new Text],this.#r=e(this.parentNode,this.#r,t,this.nextSibling)}replaceHTML(e){const t=this.parentNode.cloneNode();t.innerHTML=e,this.replace(t.childNodes)}}const n={},l=(e,t=[])=>{let s,r,n,p,c;for(s of e.attributes||[])if(s.value.includes("{{")){for([p,c]of(n={element:e,attr:s,parts:[]},i(s.value)))p?(c=new a(n,c),n.parts.push(c),t.push(c)):n.parts.push(c);s.value=n.parts.join("")}for(r of e.childNodes)if(1===r.nodeType)l(r,t);else if((3===r.nodeType||8===r.nodeType)&&r.data.includes("{{")){for([p,c]of(n={parentNode:e,parts:[]},i(r.data.trim())))p?(c=new o(n,c),n.parts.push(c),t.push(c)):n.parts.push(new Text(c));r.replaceWith(...n.parts.flatMap((e=>e.replacementNodes||[e])))}return t},i=e=>{let t,s="",r=0,a=n[e],o=0;if(a)return a;for(a=[];t=e[o];o++)"{"===t&&"{"===e[o+1]&&"\\"!==e[o-1]&&e[o+2]&&1==++r?(s&&a.push([0,s]),s="",o++):"}"!==t||"}"!==e[o+1]||"\\"===e[o-1]||--r?s+=e[o]||"":(a.push([1,s.trim()]),s="",o++);return s&&a.push([0,s]),n[e]=a};let p,c,u,h,b,d,f,m=(e,t=(c=e,p=0,u=[],!(e=x())||c[p]?g():t=>e(t||{})))=>(t.args=u,t),y=e=>e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122||36==e||95==e||e>=192&&215!=e&&247!=e,g=(e="Bad syntax",t=c[p])=>{throw SyntaxError(e+" `"+t+"` at "+p)},v=(e=1,t=p,s)=>{if("number"==typeof e)p+=e;else for(;e(c.charCodeAt(p));)p++;return c.slice(t,p)},x=(e=0,t,s,r,a,o)=>{for(;(s=S())&&(a=(o=w[s])&&o(r,e)||!r&&C());)r=a;return t&&(s==t?p++:g()),r},S=e=>{for(;(e=c.charCodeAt(p))<=32;)p++;return e},C=(e=v(y),t)=>e?(t=t=>t[e],u.push(e),t.id=()=>e,t):0,w=[],N=m.set=(e,t,s=32,r=e.charCodeAt(0),a=e.length,o=w[r],n=s.length||([s,t]=[t,s],0),l=e.toUpperCase()!==e,i=(n>1?(e,r)=>e&&(r=x(t))&&(e.length||r.length?t=>s(e(t),r(t),e.id?.(t),r.id?.(t)):(e=s(e(),r()),()=>e)):n?e=>!e&&(e=x(t-1))&&(t=>s(e(t))):s))=>w[r]=(s,r,n=p)=>r<t&&(a<2||c.substr(p,a)==e)&&(!l||!y(c.charCodeAt(p+a)))&&(p+=a,i(s,r))||(p=n,o&&o(s,r)),A=e=>e>=48&&e<=57,k=e=>(e&&g("Unexpected number"),e=v((e=>46==e||A(e))),(69==c.charCodeAt(p)||101==c.charCodeAt(p))&&(e+=v(2)+v(A)),(e=+e)!=e?g("Bad number"):()=>e),T=(e,t)=>s=>t(e.of?e.of(s):s,e.id(s));for(b=48;b<=57;)w[b++]=k;for(h=['"',e=>(e=e?g("Unexpected string"):v((e=>e-34)),v()||g("Bad string"),()=>e),,".",(e,t)=>(S(),t=v(y)||g(),f=s=>e(s)[t],f.id=()=>t,f.of=e,f),18,".",e=>!e&&k(v(-1)),,"[",(e,t,s)=>e&&(t=x(0,93)||g(),(s=s=>e(s)[t(s)]).id=t,s.of=e,s),18,"(",(e,t,s)=>(t=x(0,41),e?s=>e(s).apply(e.of?.(s),t?t.all?t.all(s):[t(s)]:[]):t||g()),18,",",(e,t,s=x(1))=>(s.all=e.all?t=>[...e.all(t),s(t)]:t=>[e(t),s(t)],s),1,"|",6,(e,t)=>e|t,"||",4,(e,t)=>e||t,"&",8,(e,t)=>e&t,"&&",5,(e,t)=>e&&t,"^",7,(e,t)=>e^t,"==",9,(e,t)=>e==t,"!=",9,(e,t)=>e!=t,">",10,(e,t)=>e>t,">=",10,(e,t)=>e>=t,">>",11,(e,t)=>e>>t,">>>",11,(e,t)=>e>>>t,"<",10,(e,t)=>e<t,"<=",10,(e,t)=>e<=t,"<<",11,(e,t)=>e<<t,"+",12,(e,t)=>e+t,"+",15,e=>+e,"++",e=>T(e||x(14),e?(e,t)=>e[t]++:(e,t)=>++e[t]),15,"-",12,(e,t)=>e-t,"-",15,e=>-e,"--",e=>T(e||x(14),e?(e,t)=>e[t]--:(e,t)=>--e[t]),15,"!",15,e=>!e,"*",13,(e,t)=>e*t,"/",13,(e,t)=>e/t,"%",13,(e,t)=>e%t];[b,d,f,...h]=h,b;)N(b,d,f);Symbol.observable||=Symbol("observable");var j=(e,t,s,r,a)=>e&&(e.subscribe?.(t,s,r)||e[Symbol.observable]?.().subscribe?.(t,s,r)||e.set&&e.call?.(a,t)||(e.then?.((e=>(!a&&t(e),r?.())),s)||(async o=>{try{for await(e of e){if(a)return;t(e)}r?.()}catch(e){s?.(e)}})())&&(e=>a=1));const U=(e,t,s,r)=>(e[t="on"===t.slice(0,2)?t.toLowerCase():t]!==s&&(!(t in e.constructor.prototype)||!(r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t))||r.set)&&(e[t]=s),!1===s||null==s?e.removeAttribute(t):"function"!=typeof s&&e.setAttribute(t,!0===s?"":"number"==typeof s||"string"==typeof s?s:"class"===t&&Array.isArray(s)?s.filter(Boolean).join(" "):"style"===t&&s.constructor===Object&&(t=s,s=Object.values(s),Object.keys(t).map(((e,t)=>`${e}: ${s[t]};`)).join(" "))));m.set(":",3.1,((e,t)=>[e,t])),m.set("?",3,((e,t)=>e?t[0]:t[1])),m.set("true",(e=>{if(e)throw new SyntaxError("Unexpected");return()=>!0})),m.set("false",(e=>{if(e)throw new SyntaxError("Unexpected");return()=>!1})),m.set("?.",18,((e,t,s,r)=>e?.[r])),m.set("|",6,((e,t)=>t(e)));const O=Symbol("params"),B=Symbol("init");Symbol.dispose||=Symbol("dispose");var E={createCallback(e,t,s){e[O]=s;for(const e of t)e.evaluate=m(e.expression);let r,a=[];for(const n in s)(o=r=s[n])&&(o[Symbol.observable]||o[Symbol.asyncIterator]||o.call&&o.set||o.subscribe||o.then)&&(s[n]="",a.push(j(r,(s=>this.processCallback(e,t,{[n]:s})))));var o;const n=e[Symbol.dispose];e[Symbol.dispose]=()=>(a.map((e=>e())),n?.()),e[B]=!0},processCallback(e,t,s,r){if(Object.assign(e[O],s),e[B])for(const s of t)(r=s.evaluate(e[O]))!==s.value&&(s.attributeName&&1===s.setter.parts.length?U(s.element,s.attributeName,s.value=r):s.value=r)}},I=(e,t,s=E)=>{(t||={})[Symbol.dispose]=e[Symbol.dispose];let r,a=l(e),o=()=>{r||(s.processCallback(e,a,t),r=Promise.resolve().then((()=>(r=null,s.processCallback(e,a,t)))))};return s.createCallback?.(e,a,t),s.processCallback(e,a,t),new Proxy(t,{set:(e,t,s)=>(e[t]=s,o(),1),deleteProperty:(e,t)=>(delete e[t],o())})};export{a as AttributeTemplatePart,o as NodeTemplatePart,s as TemplateInstance,r as TemplatePart,I as default,E as processor};