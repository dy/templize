let e,t,r,s,a,l,n,o=(s,a=(t=s,e=0,r=[],!(s=u())||t[e]?c():e=>s(e||{})))=>(a.args=r,a),i=e=>e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122||36==e||95==e||e>=192&&215!=e&&247!=e,c=(r="Bad syntax",s=t[e])=>{throw SyntaxError(r+" `"+s+"` at "+e)},p=(r=1,s=e,a)=>{if("number"==typeof r)e+=r;else for(;r(t.charCodeAt(e));)e++;return t.slice(s,e)},u=(t=0,r,s,a,l,n)=>{for(;(s=h())&&(l=(n=d[s])&&n(a,t)||!a&&b());)a=l;return r&&(s==r?e++:c()),a},h=r=>{for(;(r=t.charCodeAt(e))<=32;)e++;return r},b=(e=p(i),t)=>e?(t=t=>t[e],r.push(e),t.id=()=>e,t):0,d=[],f=o.set=(r,s,a=32,l=r.charCodeAt(0),n=r.length,o=d[l],c=a.length||([a,s]=[s,a],0),p=r.toUpperCase()!==r,h=(c>1?(e,t)=>e&&(t=u(s))&&(e.length||t.length?r=>a(e(r),t(r)):(e=a(e(),t()),()=>e)):c?e=>!e&&(e=u(s-1))&&(t=>a(e(t))):a))=>d[l]=(a,l,c=e)=>l<s&&(n<2||t.substr(e,n)==r)&&(!p||!i(t.charCodeAt(e+n)))&&(e+=n,h(a,l))||(e=c,o&&o(a,l)),m=e=>e>=48&&e<=57,g=r=>(r&&c("Unexpected number"),r=p((e=>46==e||m(e))),(69==t.charCodeAt(e)||101==t.charCodeAt(e))&&(r+=p(2)+p(m)),(r=+r)!=r?c("Bad number"):()=>r),v=(e,t,r=e.of)=>s=>t(r?r(s):s,e.id());for(a=48;a<=57;)d[a++]=g;for(s=['"',e=>(e=e?c("Unexpected string"):p((e=>e-34)),p()||c("Bad string"),()=>e),,".",(e,t,r)=>e?(h(),t=p(i)||c(),(r=r=>e(r)[t]).id=()=>t,r.of=e,r):g(p(-1)),18,"[",(e,t,r)=>e&&(t=u(0,93)||c(),(r=r=>e(r)[t(r)]).id=t,r.of=e,r),18,"(",(e,t,r)=>(t=u(0,41),e?r=>e(r).apply(e.of?.(r),t?t.all?t.all(r):[t(r)]:[]):t||c()),18,",",(e,t,r=u(1))=>(r.all=e.all?t=>[...e.all(t),r(t)]:t=>[e(t),r(t)],r),1,"|",6,(e,t)=>e|t,"||",4,(e,t)=>e||t,"&",8,(e,t)=>e&t,"&&",5,(e,t)=>e&&t,"^",7,(e,t)=>e^t,"==",9,(e,t)=>e==t,"!=",9,(e,t)=>e!=t,">",10,(e,t)=>e>t,">=",10,(e,t)=>e>=t,">>",11,(e,t)=>e>>t,">>>",11,(e,t)=>e>>>t,"<",10,(e,t)=>e<t,"<=",10,(e,t)=>e<=t,"<<",11,(e,t)=>e<<t,"+",12,(e,t)=>e+t,"+",15,e=>+e,"++",e=>v(e||u(14),e?(e,t)=>e[t]++:(e,t)=>++e[t]),15,"-",12,(e,t)=>e-t,"-",15,e=>-e,"--",e=>v(e||u(14),e?(e,t)=>e[t]--:(e,t)=>--e[t]),15,"!",15,e=>!e,"*",13,(e,t)=>e*t,"/",13,(e,t)=>e/t,"%",13,(e,t)=>e%t];[a,l,n,...s]=s,a;)f(a,l,n);Symbol.observable||(Symbol.observable=Symbol("observable"));const x=(e,t,r)=>(t.next=t,e&&(e.subscribe?.(t)||e[Symbol.observable]?.().subscribe?.(t)||e.set&&e.call?.(r,t)||(e.then?.((e=>!r&&t(e)))||(async s=>{for await(e of e){if(r)return;t(e)}})())&&(e=>r=1))),C={processCallback(e,t,r){if(r)for(const e of t)e.expression in r&&(e.value=r[e.expression])}},S=(...e)=>({createCallback:(t,r,s)=>e.map((e=>e.createCallback?.(t,r,s))),processCallback:(t,r,s)=>e.map((e=>e.processCallback?.(t,r,s)))}),y={createCallback(e,t,r){for(const e of t)e.evaluate=o(e.expression)},processCallback(e,t,r){for(const e of t)e.value=e.evaluate(r)}},N={createCallback(e,t,r,s=[]){for(const e in r)(a=r[e])&&(a[Symbol.observable]||a[Symbol.asyncIterator]||a.call&&a.set||a.subscribe||a.then)&&(s.push(x(r[e],(t=>r[e]=t))),r[e]=null);var a}};class k extends DocumentFragment{#e;#t;constructor(e,t,r=C){super(),this.appendChild(e.content.cloneNode(!0)),this.#e=B(this),this.#t=r,r.createCallback?.(this,this.#e,t),r.processCallback?.(this,this.#e,t)}update(e){this.#t.processCallback?.(this,this.#e,e)}}class w{constructor(e,t){this.setter=e,this.expression=t}toString(){return this.value}}class A extends w{#r="";get attributeName(){return this.setter.attr.name}get attributeNamespace(){return this.setter.attr.namespaceURI}get element(){return this.setter.element}get value(){return this.#r}set value(e){this.#r=e;const{attr:t,element:r,parts:s}=this.setter;1===s.length?null===s[0].value?r.removeAttributeNS(t.namespaceURI,t.name):r.setAttributeNS(t.namespaceURI,t.name,e):r.setAttributeNS(t.namespaceURI,t.name,s.join(""))}get booleanValue(){this.setter.element.hasAttribute(this.setter.attr.name)}set booleanValue(e){if(1!==this.setter.parts.length)throw new DOMException("Value is not fully templatized");this.value=""}}class T extends w{#s=[new Text];get replacementNodes(){return this.#s}get parentNode(){return this.setter.parentNode}get nextSibling(){return this.#s[this.#s.length-1].nextSibling}get previousSibling(){return this.#s[0].previousSibling}get value(){return this.#s.map((e=>e.textContent)).join("")}set value(e){this.replace(e)}replace(...e){e=e.length?e.flatMap((e=>e.forEach?[...e]:e.trim?[new Text(e)]:[e])):[new Text],this.#s=((e,t,r,s=null)=>{let a,l,n,o=0,i=r.length,c=t.length;for(;o<i&&o<c&&t[o]==r[o];)o++;for(;o<i&&o<c&&r[i-1]==t[c-1];)s=r[(--c,--i)];if(o==c)for(;o<i;)e.insertBefore(r[o++],s);else{for(a=t[o];o<i;)n=r[o++],l=a?a.nextSibling:s,a==n?a=l:o<i&&r[o]==l?(e.replaceChild(n,a),a=l):e.insertBefore(n,a);for(;a!=s;)l=a.nextSibling,e.removeChild(a),a=l}return r})(this.parentNode,this.#s,e,this.nextSibling)}replaceHTML(e){const t=this.parentNode.cloneNode();t.innerHTML=e,this.replace(t.childNodes)}}const U={},B=(e,t=[])=>{for(let r of e.attributes||[])if(r.value.includes("{{")){let s={element:e,attr:r,parts:[]};for(let[e,a]of I(r.value))e?(a=new A(s,a),s.parts.push(a),t.push(a)):s.parts.push(a);r.value=s.parts.join("")}for(let r of e.childNodes)if(1===r.nodeType)B(r,t);else if(3===r.nodeType&&r.data.includes("{{")){let s={parentNode:e,parts:[]};for(let[e,a]of I(r.data.trim()))e?(a=new T(s,a),s.parts.push(a),t.push(a)):s.parts.push(new Text(a));r.replaceWith(...s.parts.flatMap((e=>e.replacementNodes||[e])))}return t},I=e=>{let t,r="",s=0,a=U[e],l=0;if(a)return a;for(a=[];t=e[l];l++)"{"===t&&"{"===e[l+1]&&"\\"!==e[l-1]&&e[l+2]?1==++s&&(r&&a.push([0,r]),r="",l+=2):"}"===t&&"}"===e[l+1]&&"\\"!==e[l-1]&&(--s||(s=!1,a.push([1,r.trim()]),r="",l+=2)),r+=e[l]||"";return r&&a.push([0,r]),U[e]=a};var M=(e,t={},r=C)=>{let s,a=B(e),l=()=>!s&&(s=Promise.resolve().then((()=>(s=null,r.processCallback?.(e,a,t)))));return r.createCallback?.(e,a,t),r.processCallback?.(e,a,t),new Proxy(t,{set:(e,t,r)=>(e[t]=r,l(),1),deleteProperty:(e,t)=>(delete e[t],l())})};export{A as AttributeTemplatePart,T as NodeTemplatePart,k as TemplateInstance,w as TemplatePart,S as combine,M as default,C as direct,y as expressions,N as reactivity};