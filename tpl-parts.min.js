const e={};var t=t=>{let r,s="",a=0,l=e[t],n=0;if(l)return l;for(l=[];r=t[n];n++)"{"===r&&"{"===t[n+1]&&"\\"!==t[n-1]&&t[n+2]?1==++a&&(s&&l.push([0,s]),s="",n+=2):"}"===r&&"}"===t[n+1]&&"\\"!==t[n-1]&&(--a||(a=!1,l.push([1,s.trim()]),s="",n+=2)),s+=t[n]||"";return s&&l.push([0,s]),e[t]=l};class r extends DocumentFragment{#e;constructor(e,t,r){super(),this.appendChild(e.content.cloneNode(!0)),this.#e=I(this,t,r)}update(e){Object.assign(this.#e,e)}}class s{constructor(e,t){this.setter=e,this.expression=t}toString(){return this.value}}class a extends s{#t="";get attributeName(){return this.setter.attr.name}get attributeNamespace(){return this.setter.attr.namespaceURI}get element(){return this.setter.element}get value(){return this.#t}set value(e){this.#t=e;const{attr:t,element:r,parts:s}=this.setter;1===s.length?null===s[0].value?r.removeAttributeNS(t.namespaceURI,t.name):r.setAttributeNS(t.namespaceURI,t.name,e):r.setAttributeNS(t.namespaceURI,t.name,s.join(""))}get booleanValue(){this.setter.element.hasAttribute(this.setter.attr.name)}set booleanValue(e){if(1!==this.setter.parts.length)throw new DOMException("Value is not fully templatized");this.value=""}}class l extends s{#r=[new Text];get replacementNodes(){return this.#r}get parentNode(){return this.setter.parentNode}get nextSibling(){return this.#r[this.#r.length-1].nextSibling}get previousSibling(){return this.#r[0].previousSibling}get value(){return this.#r.map((e=>e.textContent)).join("")}set value(e){this.replace(e)}replace(...e){e=e.length?e.flatMap((e=>e.forEach?[...e]:e.trim?[new Text(e)]:[e])):[new Text],this.#r=((e,t,r,s=null)=>{let a,l,n,o=0,i=r.length,u=t.length;for(;o<i&&o<u&&t[o]==r[o];)o++;for(;o<i&&o<u&&r[i-1]==t[u-1];)s=r[(--u,--i)];if(o==u)for(;o<i;)e.insertBefore(r[o++],s);else{for(a=t[o];o<i;)n=r[o++],l=a?a.nextSibling:s,a==n?a=l:o<i&&r[o]==l?(e.replaceChild(n,a),a=l):e.insertBefore(n,a);for(;a!=s;)l=a.nextSibling,e.removeChild(a),a=l}return r})(this.parentNode,this.#r,e,this.nextSibling)}replaceHTML(e){const t=this.parentNode.cloneNode();t.innerHTML=e,this.replace(t.childNodes)}}let n,o,i,u,c,p,h,b=(e,t=(o=e,n=0,i=[],!(e=g())||o[n]?f():t=>e(t||{})))=>(t.args=i,t),d=e=>e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122||36==e||95==e||e>=192&&215!=e&&247!=e,f=(e="Bad syntax",t=o[n])=>{throw SyntaxError(e+" `"+t+"` at "+n)},m=(e=1,t=n,r)=>{if("number"==typeof e)n+=e;else for(;e(o.charCodeAt(n));)n++;return o.slice(t,n)},g=(e=0,t,r,s,a,l)=>{for(;(r=v())&&(a=(l=C[r])&&l(s,e)||!s&&x());)s=a;return t&&(r==t?n++:f()),s},v=e=>{for(;(e=o.charCodeAt(n))<=32;)n++;return e},x=(e=m(d),t)=>e?(t=t=>t[e],i.push(e),t.id=()=>e,t):0,C=[],S=b.set=(e,t,r=32,s=e.charCodeAt(0),a=e.length,l=C[s],i=r.length||([r,t]=[t,r],0),u=e.toUpperCase()!==e,c=(i>1?(e,s)=>e&&(s=g(t))&&(e.length||s.length?t=>r(e(t),s(t)):(e=r(e(),s()),()=>e)):i?e=>!e&&(e=g(t-1))&&(t=>r(e(t))):r))=>C[s]=(r,s,i=n)=>s<t&&(a<2||o.substr(n,a)==e)&&(!u||!d(o.charCodeAt(n+a)))&&(n+=a,c(r,s))||(n=i,l&&l(r,s)),y=e=>e>=48&&e<=57,N=e=>(e&&f("Unexpected number"),e=m((e=>46==e||y(e))),(69==o.charCodeAt(n)||101==o.charCodeAt(n))&&(e+=m(2)+m(y)),(e=+e)!=e?f("Bad number"):()=>e),k=(e,t,r=e.of)=>s=>t(r?r(s):s,e.id());for(c=48;c<=57;)C[c++]=N;for(u=['"',e=>(e=e?f("Unexpected string"):m((e=>e-34)),m()||f("Bad string"),()=>e),,".",(e,t,r)=>e?(v(),t=m(d)||f(),(r=r=>e(r)[t]).id=()=>t,r.of=e,r):N(m(-1)),18,"[",(e,t,r)=>e&&(t=g(0,93)||f(),(r=r=>e(r)[t(r)]).id=t,r.of=e,r),18,"(",(e,t,r)=>(t=g(0,41),e?r=>e(r).apply(e.of?.(r),t?t.all?t.all(r):[t(r)]:[]):t||f()),18,",",(e,t,r=g(1))=>(r.all=e.all?t=>[...e.all(t),r(t)]:t=>[e(t),r(t)],r),1,"|",6,(e,t)=>e|t,"||",4,(e,t)=>e||t,"&",8,(e,t)=>e&t,"&&",5,(e,t)=>e&&t,"^",7,(e,t)=>e^t,"==",9,(e,t)=>e==t,"!=",9,(e,t)=>e!=t,">",10,(e,t)=>e>t,">=",10,(e,t)=>e>=t,">>",11,(e,t)=>e>>t,">>>",11,(e,t)=>e>>>t,"<",10,(e,t)=>e<t,"<=",10,(e,t)=>e<=t,"<<",11,(e,t)=>e<<t,"+",12,(e,t)=>e+t,"+",15,e=>+e,"++",e=>k(e||g(14),e?(e,t)=>e[t]++:(e,t)=>++e[t]),15,"-",12,(e,t)=>e-t,"-",15,e=>-e,"--",e=>k(e||g(14),e?(e,t)=>e[t]--:(e,t)=>--e[t]),15,"!",15,e=>!e,"*",13,(e,t)=>e*t,"/",13,(e,t)=>e/t,"%",13,(e,t)=>e%t];[c,p,h,...u]=u,c;)S(c,p,h);Symbol.observable||(Symbol.observable=Symbol("observable"));const w=(e,t,r)=>(t.next=t,e&&(e.subscribe?.(t)||e[Symbol.observable]?.().subscribe?.(t)||e.set&&e.call?.(r,t)||(e.then?.((e=>!r&&t(e)))||(async s=>{for await(e of e){if(r)return;t(e)}})())&&(e=>r=1))),A={processCallback(e,t,r){if(r)for(const e of t)e.expression in r&&(e.value=r[e.expression])}},T=(...e)=>({createCallback:(t,r,s)=>e.map((e=>e.createCallback?.(t,r,s))),processCallback:(t,r,s)=>e.map((e=>e.processCallback?.(t,r,s)))}),U={createCallback(e,t,r){for(const e of t)e.evaluate=b(e.expression)},processCallback(e,t,r){for(const e of t)e.value=e.evaluate(r)}},B={createCallback(e,t,r,s=[]){for(const e in r)(a=r[e])&&(a[Symbol.observable]||a[Symbol.asyncIterator]||a.call&&a.set||a.subscribe||a.then)&&(s.push(w(r[e],(t=>r[e]=t))),r[e]=null);var a}},I=(e,t={},r=A)=>{let s,a=M(e),l=()=>!s&&(s=Promise.resolve().then((()=>(s=null,r.processCallback?.(e,a,t)))));return r.createCallback?.(e,a,t),r.processCallback?.(e,a,t),new Proxy(t,{set:(e,t,r)=>(e[t]=r,l()),deleteProperty:(e,t)=>(delete e[t],l())})},M=(e,r=[])=>{for(let s of e.attributes||[])if(s.value.includes("{{")){let l={element:e,attr:s,parts:[]};for(let[e,n]of t(s.value))e?(n=new a(l,n),l.parts.push(n),r.push(n)):l.parts.push(n);s.value=l.parts.join("")}for(let s of e.childNodes)if(1===s.nodeType)M(s,r);else if(3===s.nodeType&&s.data.includes("{{")){let a={parentNode:e,parts:[]};for(let[e,n]of t(s.data.trim()))e?(n=new l(a,n),a.parts.push(n),r.push(n)):a.parts.push(new Text(n));s.replaceWith(...a.parts.flatMap((e=>e.replacementNodes||[e])))}return r};export{a as AttributeTemplatePart,l as NodeTemplatePart,r as TemplateInstance,s as TemplatePart,T as combine,I as default,A as direct,U as expressions,B as reactivity};